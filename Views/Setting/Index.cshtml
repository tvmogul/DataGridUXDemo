@using DataGridUXDemo.Helpers

@{
    ViewData["Title"] = "Settings";
    var scriptNonce = Html.ScriptNonce();
    var soundList = ViewBag.Sounds as List<SelectListItem>;
}

<div style="margin-top: 0px !important;">
    <div style="position: relative; max-width: 800px; margin: 0 auto;">
        @* <canvas id="netcanvas" width="800" height="70" style="display: block; width: 100%; height: 70px; border: none transparent;"></canvas> *@
        <div style="text-align: center;" class="table-block">
            <h2 style="margin-top: -50px; white-space: nowrap;">
                @* <img src="/img/title_settings.gif" alt="Settings" style="height: 50px; vertical-align: top; margin-top: -12px;margin-right: 4px;"> *@
                Settings
            </h2>
        </div>
    </div>
</div>
<br />

<div class="d-flex
            flex-column
            align-items-center
            justify-content-between
            p-3 border
            rounded
            mx-auto"
    style="width: 80%;">

    <div class="d-flex justify-content-end align-items-center mb-3">
        <h3>Select Either A Light Theme or dark Theme&nbsp;</h3>
        <button id="themeToggle" class="btn btn-outline-secondary btn-sm">
            🌙 Dark Mode
        </button>
    </div>
</div>
<br />

<div class="d-flex
            flex-column
            align-items-center
            justify-content-between
            mt-3 p-3 border
            rounded
            mx-auto"
     style="width: 80%;">
    <table>
        <tr>
            <td style="vertical-align: top !important;">
                <h3>Your Companies</h3>
                <h5>Click on path(s) below to copy path</h5>
@*                 @foreach (var fullPath in Model)
                {
                    <input type="text"
                           class="copy-path"
                           style="max-width: 90% !important;"
                           value="@fullPath"
                           readonly
                           onclick="this.select();
                               document.execCommand('copy');"
                           title="Click to copy full path" />
                }
 *@
                <br />
                <br />
                <button id="btnBackUp" class="btn btn-primary" type="button">Back Up (Download ZIP)</button>
                <button id="btnHelp" class="btn btn-primary" type="button">Help</button>
            </td>

            <td style=" vertical-align: top !important;" padding: 4px 0px 1px 12px !important;font-size: 1.2em;font-weight: bold; color: #2a9df4;">
                <h6>Select Sounds (coming soon!)</h6>
                <div id="status" class="mt-2 text-muted" style="font-size: .7em !important;"> <h6>Sound</h6></div>
                <div class="mb-3">
                    @* <select id="soundSelect" class="form-select sky-border" size="7"
                                style="width: 240px; font-size: .8rem; line-height: 1; overflow-y: auto;">
                            <option value="">NO SOUND</option>
                            @foreach (var sound in soundList!)
                            {
                                <option value="@sound.Value">@sound.Text</option>
                            }
                        </select> *@
                    <audio id="soundPlayer" style="display: none;"></audio>
                </div>
                <div style="display: flex; flex-direction: column; gap: 2px; font-size: 0.95rem; line-height: 1;">
                    <label style="margin: 0; padding: 0;"><input type="radio" name="action" value="save"> Save</label>
                    <label style="margin: 0; padding: 0;"><input type="radio" name="action" value="delete"> Delete</label>
                    <label style="margin: 0; padding: 0;"><input type="radio" name="action" value="help"> Help</label>
                </div><br />
                <input id="btnSaveSound" class="button white btn_sm" type="button" value="Save" />
                <input id="btnHelp" class="button white btn_sm" type="button" value="Help" style="margin-top: 12px !important;" />
            </td>
        </tr>
    </table>
</div>
<br />

<div class="d-flex
            flex-column
            align-items-center
            justify-content-between
            mt-3 p-3 border
            rounded
            mx-auto"
     style="width: 80%;">

    <div class="text-center p-3 mt-3 border border-3 border-danger rounded bg-light shadow-sm" style="max-width: 860px;">
        <h5 class="fw-bold text-danger text-uppercase mb-3">
            ⚠️ Security Warning ⚠️
        </h5>
        <div class="fw-semibold text-dark mb-3" style="font-size: 1rem;">
            For Security in Windows 10 & 11, we strongly recommend <strong>DISABLING</strong> settings below.<br />
            <span class="text-danger fw-bold">These settings can store sensitive data and expose it to third parties.</span>
        </div>

        <!-- add changes that NSIS script will make!!! -->
        <ul class="list-group text-start mb-4 shadow-sm">
            <li class="list-group-item">
                <strong>Disable Clipboard History (Policy)</strong><br />
                HKLM\SOFTWARE\Policies\Microsoft\Windows\System → <code>AllowClipboardHistory</code> = <code>0</code> (DWORD)
            </li>
            <li class="list-group-item">
                <strong>Mirror Clipboard Setting</strong><br />
                HKCU\Software\Microsoft\Clipboard → <code>EnableClipboardHistory</code> = <code>0</code> (DWORD)<br />
                HKLM\SOFTWARE\Microsoft\Clipboard → <code>EnableClipboardHistory</code> = <code>0</code> (DWORD)
            </li>
            <li class="list-group-item">
                <strong>Disable Screen Clipping / Snipping Tool (Policy)</strong><br />
                HKLM\SOFTWARE\Policies\Microsoft\TabletPC → <code>DisableSnippingTool</code> = <code>1</code> (DWORD)
            </li>
            <li class="list-group-item">
                <strong>Block Screen Clipping (Mirrors)</strong><br />
                HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ScreenClipBlock → <code>BlockScreenClip</code> = <code>1</code> (DWORD)<br />
                HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ScreenClipBlock → <code>BlockScreenClip</code> = <code>1</code> (DWORD)
            </li>
            <li class="list-group-item">
                <strong>Optional Hotkey Suppression</strong><br />
                HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced → <code>DisabledHotkeys</code> = <code>"S"</code> (REG_SZ)
            </li>
        </ul>
        <!-- /changes -->

        <button id="btnApplySecurityHardening" class="btn btn-danger fw-bold">
            Apply Security Hardening (Windows Only)
        </button>

        <div id="hardeningStatus" class="mt-3 small text-muted" aria-live="polite"></div>
    </div>
</div>
<br />

<div class="d-flex
            flex-column
            align-items-center
            justify-content-between
            mt-3 p-3 border
            rounded
            mx-auto"
     style="width: 80%;">
    <div class="d-flex align-items-center gap-2 mb-2">
        <span class="fs-5">⚠️</span>
        <span class="fw-bold text-uppercase">Legal Disclaimer</span>
    </div>
    <ul class="mb-0 text-secondary ps-4">
        <li>Always back up your data before modifying system settings.</li>
        <li>The methods shown are safe when followed correctly.</li>
        <li>We are not responsible for any changes you make to your system.</li>
        <li>Consult Microsoft’s official documentation for additional information.</li>
        <li>Some features may be required for system stability.</li>
        <li>This content does not constitute professional advice. If you have concerns about your system, consult a qualified IT professional.</li>
    </ul>
</div>


<br />
<br />
<br />
<br />
<br />

@section Scripts {

    <script src="~/js/companyModalListener.js" nonce="@scriptNonce"></script>

    <script nonce="@scriptNonce">

        var table1;
        let container;

        // document.getElementById("soundSelect").addEventListener("change", function () {
        //     const selectedSound = this.value;
        //     document.getElementById("status").textContent = selectedSound;

        //     fetch('/Setting/PlaySound', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify({ soundKey: selectedSound })
        //     })
        //     .then(response => {
        //         if (!response.ok) throw new Error("Failed to load sound path");
        //         return response.json();
        //     })
        //     .then(data => {
        //         const audio = document.getElementById("soundPlayer");
        //         audio.src = data.path;
        //         audio.style.display = "block";
        //         audio.load();
        //         audio.play()
        //             .then(() => {
        //                 document.getElementById("status").textContent = selectedSound;
        //             })
        //             .catch(err => {
        //                 document.getElementById("status").textContent = "Playback failed.";
        //                 console.error("Playback error:", err);
        //             });
        //     })
        //     .catch(error => {
        //         document.getElementById("status").textContent = "Error loading sound.";
        //         console.error("Fetch error:", error);
        //     });
        // });


        document.addEventListener('DOMContentLoaded', function () {
          const btn = document.getElementById('btnBackUp');
          if (!btn) return;
          btn.addEventListener('click', function () {
            window.location.href = '/Backup/Download';
          });
        });

        document.getElementById('btnHelp').addEventListener('click', function () {
            const helpUrl = encodeURIComponent("https://ainetprofit.com/Manual#settings");
            fetch(`/Home/LaunchHelp?url=${helpUrl}`)
                .then(response => {
                    if (!response.ok) throw new Error("Failed to launch help");
                    console.log("Help launched");
                })
                .catch(error => console.error("Error:", error));
        });

        (function () {
            const btn = document.getElementById('btnApplySecurityHardening');
            const statusBox = document.getElementById('hardeningStatus');

            function setStatus(msg, ok) {
                statusBox.textContent = msg;
                statusBox.className = 'mt-3 small ' + (ok ? 'text-success' : 'text-danger');
            }

            function isMac() {
                const ua = navigator.userAgent || '';
                return /Macintosh|Mac OS X/i.test(ua);
            }

            btn?.addEventListener('click', function () {
                if (isMac()) {
                    setStatus('This hardening action is for Windows only. No changes were made on macOS.', false);
                    alert('This action is for Windows only. No changes were made.');
                    return;
                }
                setStatus('Launching Windows hardening installer (you may see an Admin/UAC prompt)...', true);

                $.ajax({
                    url: '/Settings/RunHardeningInstaller',
                    type: 'POST',
                    success: function (res) {
                        setStatus(res && res.message ? res.message : 'Installer launched.', true);
                    },
                    error: function (xhr) {
                        setStatus('Failed to launch installer: ' + (xhr.responseText || xhr.statusText || 'Unknown error'), false);
                    }
                });
            });
        })();

    </script>

    <script nonce="@scriptNonce">
        // ✅ Initialize global theme for the entire app (all views)
        (function initGlobalTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';

            if (savedTheme === 'dark') {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
                document.documentElement.setAttribute('data-bs-theme', 'dark'); // Bootstrap 5.3.3 global theme
            } else {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
                document.documentElement.setAttribute('data-bs-theme', 'light'); // Bootstrap 5.3.3 global theme
            }
        })();

        document.addEventListener('DOMContentLoaded', function () {
            const themeToggle = document.getElementById('themeToggle');
            const currentTheme = localStorage.getItem('theme') || 'light';

            applyTheme(currentTheme);

            themeToggle.addEventListener('click', function () {
                const newTheme = (document.body.classList.contains('dark-theme')) ? 'light' : 'dark';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });

            function applyTheme(theme) {
                if (theme === 'dark') {
                    document.body.classList.remove('light-theme');
                    document.body.classList.add('dark-theme');
                    document.documentElement.setAttribute('data-bs-theme', 'dark'); // ✅ apply globally for all views using Bootstrap
                    themeToggle.textContent = '☀️ Light Mode';
                } else {
                    document.body.classList.remove('dark-theme');
                    document.body.classList.add('light-theme');
                    document.documentElement.setAttribute('data-bs-theme', 'light'); // ✅ apply globally for all views using Bootstrap
                    themeToggle.textContent = '🌙 Dark Mode';
                }
            }
        });
    </script>

}


